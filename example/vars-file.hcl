redis-username         = "replication-user"
redis-password         = "435e9c4225f08813ef3af7c725f0d30d263b9cd3"
redis-tls-cacert       = <<-EOF
  -----BEGIN CERTIFICATE-----
  MIIDSzCCAjOgAwIBAgIIAg26dvKrbYkwDQYJKoZIhvcNAQELBQAwIDEeMBwGA1UE
  AxMVbWluaWNhIHJvb3QgY2EgMDIwZGJhMCAXDTIxMTAyMzAyMTUxOVoYDzIxMjEx
  MDIzMDMxNTE5WjAgMR4wHAYDVQQDExVtaW5pY2Egcm9vdCBjYSAwMjBkYmEwggEi
  MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDMlMwTusfIaEz7eB8RZua6kW81
  1G5DzvO8X9GAi8mdlqoOuSmSvHNz59Vn0lUZ7H1NwyAXqPm7FgYrGzAPBKJ+Kkw9
  drJJLoeSWPtFT9lISbl9qRpYg99aWzWfuEdKYJDa5woZLoQEaARW88TcCB44wLtK
  yJpakMJZKV5gXqfpfSARyQPLsP/jirVhD+bNEs3sBBxw2WMtDdVS12V1soD2iKA5
  wTiKNjjpbyea6Q5zWcjFq2K8upx65hL75tdkHaYCqLZeeq/ciglGvXDKenZMMSY9
  Oz4qUDhxWTcb15zyolT8fQ9QdZqvBoOD6WBuWTNXbnT3zISiZGAAPQgdv9d7AgMB
  AAGjgYYwgYMwDgYDVR0PAQH/BAQDAgKEMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggr
  BgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQWBBQP6Fb0a7XEzSGV
  PZY5GjjuWKMQrTAfBgNVHSMEGDAWgBQP6Fb0a7XEzSGVPZY5GjjuWKMQrTANBgkq
  hkiG9w0BAQsFAAOCAQEASfe9zRlpIXHy4+mp1PIpjGjJjk0NhPOcoN8B2vCqYWsJ
  nnfl9zfORkWPL6PgiXWqS6nNC+iqRFBWphaRqtSle0j+4NLFnmmOMXI/NlCjAvTH
  6TNJ/H0nHlJ9p3Ui9a5MvZ8I/dOJLrFDX4/d9Lg76txKhFJBzXvxd9PSVKPJvnfx
  x3aare5fkXy+JlZwP8FhbzIwVTmHGPxKEUCbImhmailXTfLTmm+bS1CW2OrOnlSn
  ZPlEA8N1Y8ogNZQf2v65QCT7k64a1IuEA7XcH+W4+JhRAPPp1NujMTbeo855gMMm
  D6LXhbMEV2jO6Yfqgr2H+fmiWq3nILj/XBSTEYNBqQ==
  -----END CERTIFICATE-----

EOF
redis-tls-cert         = <<-EOF
  -----BEGIN CERTIFICATE-----
  MIIDVjCCAj6gAwIBAgIIP+tRomVdVFgwDQYJKoZIhvcNAQELBQAwIDEeMBwGA1UE
  AxMVbWluaWNhIHJvb3QgY2EgMDIwZGJhMB4XDTIxMTAyODAyMjA1M1oXDTIzMTEy
  NzAzMjA1M1owEDEOMAwGA1UEAxMFcmVkaXMwggEiMA0GCSqGSIb3DQEBAQUAA4IB
  DwAwggEKAoIBAQDLjxXgcb2GjCoH9EEObm951uExMC+GfiCSlAtCFg1v4kmenUh2
  HbTYTho3v88QTfH4tgqwEf7qttJ3oNd8g/Kaf9NebPJ+4McEgfdoYBQhb2Aq5ZSo
  lYDThYm4rBPk6efgNHVpJ4WAX/NnwjQmnKfPRDtXrzEDzobUJSZ0kqbw6LbZz9m+
  0JsT46/wSO5DEAg1mijK537iQHt3xEb3pq+PR79smNzjOdC+Vk+g7oNz+y0ajUHG
  OVQ+aVyAhFGjy6vkACGaR/vvh2yxbFghvi1gMKkbAgzBVJrAnysxb9C5euhelWHI
  BwThBwqqUyc/eC/IvJirvoYSCX63XlyXAb4hAgMBAAGjgaMwgaAwDgYDVR0PAQH/
  BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8E
  AjAAMB8GA1UdIwQYMBaAFA/oVvRrtcTNIZU9ljkaOO5YoxCtMEAGA1UdEQQ5MDeC
  BXJlZGlzhwQKISEChwQKISEDhwQKISEEhwQKISEFhwQKISEGhwQKISEHhwQKISEI
  hwQKISEJMA0GCSqGSIb3DQEBCwUAA4IBAQDFZQHp+yeNsbRrMyUEzVJB/vBjbMyn
  UCaCXQDxxWJmrZ8qIY2mPVRYzgGBAOhla0MGt1p1EAg2gOcA5ouJy03Lt6Le17dS
  zBZE/miBdgT6Hz9VGg5+PXOEX1xFOdILaq1wWlY3DLAg0uj2XF2xvWcIMpvtng9E
  cmDKTI+FMTeSeUuYDrn4ddWlad2kDpyrfUo1QR/RjvNm+h3mu1hTo04egjclbMsX
  ZG4Sv/XzEu1BoX0X3A5FyiNMqJidtT3YFoU1R5qLTxF6tCFlGM26jO8cxCo7Idv0
  /0FGShgrKA38ucttGEI9LsKBg4j+/0wFJ3zk4M8bA140hu0Dh2O4B7WL
  -----END CERTIFICATE-----

EOF
redis-tls-key          = <<-EOF
  -----BEGIN RSA PRIVATE KEY-----
  MIIEpQIBAAKCAQEAy48V4HG9howqB/RBDm5vedbhMTAvhn4gkpQLQhYNb+JJnp1I
  dh202E4aN7/PEE3x+LYKsBH+6rbSd6DXfIPymn/TXmzyfuDHBIH3aGAUIW9gKuWU
  qJWA04WJuKwT5Onn4DR1aSeFgF/zZ8I0Jpynz0Q7V68xA86G1CUmdJKm8Oi22c/Z
  vtCbE+Ov8EjuQxAINZooyud+4kB7d8RG96avj0e/bJjc4znQvlZPoO6Dc/stGo1B
  xjlUPmlcgIRRo8ur5AAhmkf774dssWxYIb4tYDCpGwIMwVSawJ8rMW/QuXroXpVh
  yAcE4QcKqlMnP3gvyLyYq76GEgl+t15clwG+IQIDAQABAoIBAHDDjhnsyFINuYb4
  f0WQVf7H064dBGbb3g11J5tvffgaAjB07txH7pPZCFsTzZA5ra7aoacSAQZjSsps
  dpMKwU1nPF9VuSwiNv2/RaAzgVNYUIzS63xMfbYvhrCf2tF35jTkupoLA8Cu5rb2
  9U7if2+pW7piWaPDOBuzjM8NIp/XPF5VXpg+EUNsVtzR8JxIjX2k0G+GRQnPbH/r
  4AqeREpfTw7KAC0l0EPGCSPZCT/a9fhnCr7YQ3l7IzYG6h3f0Yfr5fNfKVBnES7X
  WfuxOhITQ374KmUowysXNhvQIeV+wBV7dCbnobiiq8jVWIqPb8aazjNFUSEXhzTP
  7t8wPVUCgYEA/y/zOaMaAjFnHW17uGSdnJVT2Vv/81gE09QVrABx0kpr4gjjU2gS
  SwPKtfJLBFrQYFVfm/0j4LF6RKNb5swY0Nbvzp+ZFvgOiunctJiTL9cauQtC/mnn
  SQk6XRXHVv5dOeG7yORMF+sBQ7TGaF6/1N37lSwdloPlXDLznj9bWmMCgYEAzDUL
  Kju1LSLliXhPgKsVaEoVZsOJfzpLoY02t9vS6EdZzmlkYhAX75nTKIIts+Dqu3wZ
  Ct4gAUjtHSwjr1O0WtEPhWw+pVaUEWJMtVyCl1oZnVGvodGR22qk27z4ebD1GMyw
  WWrrqtakJeNicRoTfeJsFM8i4fUSiiCwPnqhiqsCgYEA1Li88RP0L1XNViuY0ZoW
  BJw6PFvDna+GvqnxsuLf/uOI0PCFx1ZewWeUyF0EicnGIDeqrpazHK/1c1gV2OvT
  1+sEFmLWM95uCQBvuZ/iOiP+o7gujXPsl+Z4X3YzKGJ7hi+U4R7mC54b/LuqFQC+
  uoydFrmipICoZlYW3JiF528CgYEAlvwBLVDIPH84x9O0tKXKRjnAaSLaXr9zfBc1
  Bev6nNNki0FRf0/24qkRfzoBIKaD5+txeJ+Tel+5MYCZQeDZ0OwSVcwa5ZSGFfRg
  Uxf7Vny/w5nKChMxjNHk4rNt5Ev6bEOrf/GWHdJlu73L42QsVT88OoaMfBT/iDFz
  Hj79gdECgYEAr9unQarZtWtpQhPr7BDra+xnj0d9dPkuP/u1+quBZ4P9zM58ZRLj
  T/ZsmbNU3TzcPaBRF3BMfJpanan16t4YiD8/LSVsnLOGfxIi7ySyS5uxqXrjCw3v
  ObYYBIwu6npx7kcKaIctNotOfyicyGSe743Os9gkdMQtP3O6gdwp61c=
  -----END RSA PRIVATE KEY-----

EOF
attache-redis-tls-cert = <<-EOF
  -----BEGIN CERTIFICATE-----
  MIIDKDCCAhCgAwIBAgIIevMTb5ZvH7cwDQYJKoZIhvcNAQELBQAwIDEeMBwGA1UE
  AxMVbWluaWNhIHJvb3QgY2EgMDIwZGJhMB4XDTIxMTAyMzAyMTc0OFoXDTIzMTEy
  MjAzMTc0OFowEjEQMA4GA1UEAxMHYm91bGRlcjCCASIwDQYJKoZIhvcNAQEBBQAD
  ggEPADCCAQoCggEBALGsKB8OaaA7H7z5yGUBwe1IfV9WR98CzwRDE+/s0sqUveQG
  ofH0MdFYteYD3iNNSJrZbhTpUQHaPc9poi9+xUBIys5Q/Iymb8QHMaHAof8ZVdc0
  zWHEWVsz96c/I6I3zQApwzI4RwQ+9lumnwGxTvsAg/6NbLLEnXV0hbBK4270RKSy
  9mtUZW6yQiIeS+vRF69M0gCBYm0HmVvZFta6Q3g+laOkFBRXxisTd9qOHiI3Yn1P
  ql53eAEMIVa4/YqM13WlcFvyIAhkt7R8+7X+XES6J2Zbufd+FXHWYXP3bEo9TTXs
  gLOEq8B/jgmWuBaQzKD+ib8ZvXTZtf9ohhUXMIMCAwEAAaN0MHIwDgYDVR0PAQH/
  BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8E
  AjAAMB8GA1UdIwQYMBaAFA/oVvRrtcTNIZU9ljkaOO5YoxCtMBIGA1UdEQQLMAmC
  B2JvdWxkZXIwDQYJKoZIhvcNAQELBQADggEBAEW2cjm61mgb0x6fQ0aLUyoVGsRy
  dd7BS3Kq88Zj5pTxrmneiAtOVb84pxK/n5aDBiLLPgPeSWNw3TtmIC1//IONRjwN
  6pcoYKNe339MKg685paeMjPhCfZtkubzLpwmBpsnLTjetNFmioJbwMdLavZf4B2K
  3O2ANT+up5mt/RgqusWWgJTdsnm0p2hcFkiErRb5XLnZYPqaUsP5NWprkz3mwbPE
  Dd/EM1m9paNREZW+dhkT/1eUwW2/wwd9gqD956Dgqe6VEjbrTXyvxI3yeC341Uov
  OtOAwYCGNCOB2m6vm7tamBtEFC07h5tfh07igetMoN/nDlec8S2tiqPtGu8=
  -----END CERTIFICATE-----

EOF
attache-redis-tls-key  = <<-EOF
  -----BEGIN RSA PRIVATE KEY-----
  MIIEpAIBAAKCAQEAsawoHw5poDsfvPnIZQHB7Uh9X1ZH3wLPBEMT7+zSypS95Aah
  8fQx0Vi15gPeI01ImtluFOlRAdo9z2miL37FQEjKzlD8jKZvxAcxocCh/xlV1zTN
  YcRZWzP3pz8jojfNACnDMjhHBD72W6afAbFO+wCD/o1sssSddXSFsErjbvREpLL2
  a1RlbrJCIh5L69EXr0zSAIFibQeZW9kW1rpDeD6Vo6QUFFfGKxN32o4eIjdifU+q
  Xnd4AQwhVrj9iozXdaVwW/IgCGS3tHz7tf5cRLonZlu5934VcdZhc/dsSj1NNeyA
  s4SrwH+OCZa4FpDMoP6Jvxm9dNm1/2iGFRcwgwIDAQABAoIBAQCq2Juf+XDyRcgo
  JJxhHEaJT/pWsZXcyUudko7aWAT+DfdnDEWvbpx07PPEoZV6prcZR9kFvLFLsbtb
  9fyh5Snxvc1ehRvEd8rjWfOM0bo0nf0gOsL/rxopjBgpN5qhQz0aWg47/Ue0uoKU
  8OzXaNNEo2NJZF7QrCWpKwne0rROHHRexj6WctSUXt/w7WPIjGwKnQTennL8VRE0
  4JTaxZWPVYGJMAxSfRAwdEYgV2sscg2f4s+kcFZJPXXVydyrFbIrsj6YaAYw/TaN
  jeDAFOPRhaP0lnP+xaFVv2fEnJczoOwgDuC2Tg7ATzooC4PQQkmuukWr38p/Cdmw
  DV/mlSBBAoGBAN5JEXwSpEvctEF53kz97n6jmhW4A3J3REAl3YrDdbESZrSVZ/tu
  HxDxQwuLF/iV0g+dV05hczhG4gB5h3e9DLO0btQuCxvLTwO8M1tdAIZe6Q2g+Uid
  rmlIPNVTp9WiPC1ihZpyn0DOkrkz0ZccRQYGfKctbSh9p779SnFwElFjAoGBAMye
  2cV2izoAqrRbQambCuGFPKXBW/2W/XxGzikZy0y2yrOf3E9dqOSNnvNQMtlcdMB+
  0sXpM3EACmfkSp0KA8CEGlsXTS8oCmQ2V06My4dha+2PegJ6fE1bFEptVpBtjED/
  kzUfJdU4dmC688jW8hwPt1SmKpmcBjk3Kpi/7F5hAoGAN7rcDl5iIL751nymdmkn
  1UpRRGa5PoaWbvrPW437wORbKaVXx5rpYQcMByXdYa62VsHc9MLL720eFn5hr2yP
  dbKkIsBUeqhza/1QZvSfQBElnwwf08vswWqiDd4GczJUohBUbM+WC9p+wL40Kw2k
  ZIlV0Vg7SO6QEvtQIba2cP8CgYEAyGlpiDMESGowx/d9h54YeSwja4HIFMeXPOqo
  r67Y5Sk/vdD8Wiu06S4gmdVaCHS60XMmA7vVq37LslfyEH+njx6UJdXbvi0siFyF
  BKV4DwAHUqUtblIDf0yOwhr3Jvx025C24NfCGWV05GcXsQV+Gqf1+w3JOayMl+uF
  aBjKbOECgYBZ5ZmVd/Fpl1vNaBegGXa9nylY50cXt5fwvmQ8p4FZ1JqOEaztTxDA
  t+HFY5W8/0453PBKE02vS/+ObTsWx8lA9t/xf329ZDyjJU1PARIHYEgsybtPMLwy
  a2DTv/R7JehM0+1TiIikrsQVQnzhF/79HRiFUmlgppwWGWe7UpvcOQ==
  -----END RSA PRIVATE KEY-----

EOF
redis-config-template  = <<-EOF
  user default off
  masteruser replication-user
  masterauth {{ env "redis-password" }}
  # Working Directory
  dir {{ env "NOMAD_ALLOC_DIR" }}/data/
  daemonize no
  # TCP Port (0 to disable)
  port 0
  bind {{ env "NOMAD_IP_db" }}
  tls-port {{ env "NOMAD_PORT_db" }}
  tls-ca-cert-file {{ env "NOMAD_ALLOC_DIR" }}/data/redis-tls/ca-cert.pem
  tls-cert-file {{ env "NOMAD_ALLOC_DIR" }}/data/redis-tls/cert.pem
  tls-key-file {{ env "NOMAD_ALLOC_DIR" }}/data/redis-tls/key.pem
  tls-cluster yes
  tls-replication yes
  cluster-enabled yes
  cluster-node-timeout 5000
  cluster-config-file {{ env "NOMAD_ALLOC_DIR" }}/data/nodes.conf
  cluster-require-full-coverage no
  appendonly yes
  save 60 1
  maxmemory-policy noeviction
  loglevel warning
  # List of renamed commands comes from:
  # https://www.digitalocean.com/community/tutorials/how-to-secure-your-redis-installation-on-ubuntu-18-04
  rename-command BGREWRITEAOF ""
  rename-command BGSAVE ""
  rename-command CONFIG ""
  rename-command DEBUG ""
  rename-command DEL ""
  rename-command FLUSHALL ""
  rename-command FLUSHDB ""
  rename-command KEYS ""
  rename-command PEXPIRE ""
  rename-command RENAME ""
  rename-command SAVE ""
  rename-command SHUTDOWN ""
  rename-command SPOP ""
  rename-command SREM ""

EOF
